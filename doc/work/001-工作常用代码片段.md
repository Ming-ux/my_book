[TOC]

# 工作常用代码片段

## 1. 一个get请求

```js
// actionTypes.js 文件
// 获取图谱数据
export const GET_CY_DATA_SCOPE_BATTLE_MAP = 'SAVE_GRAPH_DATA_INDUSTRY_MAP'

// actionCreator.js文件
import { createActions, createAction } from 'framework'
import {  GET_CY_DATA_SCOPE_BATTLE_MAP } from './actionTypes'

const actionCreator = createActions({
    getGraphData: {
        url: '/api/pmsView',
        method: 'GET',
        actionType: GET_CY_DATA_SCOPE_BATTLE_MAP
    },
})

export default actionCreator

// 组件文件
getCyData = () => {
  const { getGraphData } = this.props
  getGraphData({
    params: { start: 0, end: 0, } 
  })
    .then(res => {
    if (res.statusCode === 200) {
      console.log('res: ', res)
    }
  })
}
```



## 2. 项目中本地mock数据

在项目中的`server`文件夹创建一个文件，内容格式如下：

```js
// map.js
/**
 * 功能: 一个页面-一个组件
 * 作者: xiaolong
 * 日期: 2020-02-03
 */
 module.exports = {
    // 获取数据全景数据
    getFullShotData: {
        statusCode: 200,
        message: 'successed',
        data: (() => {
            const res = []
            for (let i = 0; i < 20; i++) {
                res.push({
                    guid: i,
                    name: `我是主题${i}`,
                    description: `我是主题${i}的描述`
                })
            }
            return res
        })()
    }
}
```

然后在`server/generator.js`文件中添加这个新文件：

```js
const map = require('./map')

module.exports = function () {
    return {
        ...map
    }
}
```

然后在项目目录下，使用`npm run server`命令来启动服务



## 3. actions、container、reducers文件写法

项目中一个模块目录分为：

```
➜  data-map ✗ tree .
.
├── actions
│   ├── actionCreator.js
│   └── actionTypes.js
├── components
│   ├── full-shot
│   │   └── index.js
│   └── main
│       └── index.jsx
├── container
│   └── full-shot.js
└── reducers
    ├── fullShot.js
    └── index.js
```

`components`文件夹主要放组件，其中`main`是主组件，其他组件都放在这个文件夹中
`actions`文件夹放reducers的actions
`container`文件夹放action和reducers的结合
`reducers`文件夹放reducers

### 3.1 actions文件夹文件写法

这个文件夹一共2个文件.

`actionCreator.js`定义活动文件:

```js
// actionCreator.js
/**
 * 功能：所有动作配置
 * 作者：小龙
 * 日期： 2020-02-04
 */

import { 
    createActions,
    // createAction
} from 'framework'
import {
    // 这里是要引入的行为
    GET_FULL_SHOT_DATA_DATA_MAP
} from './actionTypes'


const actionCreator = createActions({
//    这里写具体的请求
//    异步请求的格式如下
//     actionName: {
//         url: '请求地址',
//         method: 'GET/POST/PUT/DELETE', // 其中之一 默认为GET
//         actionType: ./actionTypes这里的常量之一, 如不需要操作reducers里的值，可不写
//         hasLoading: true/false 非必填，默认为true
//         log: { // 这里用来记录日志，如不需要可不写
//             opId: 一个唯一的日志ID数字,
//             content: 日志的描述内容,
//             isAutoSend: true, //是否自动发送日志，主要是调用接口时需要设置，有些场景需要统计用户实际点击，但有的接口在组件初始化时被调用此时不需要计入统计范围，此时需要置该参数为false
//             afterSuccess: false, //是否在成功调用接口后再进行日志的统计
//             getContent(payload, state){ 
//                当content内容不能写死时，需要动态设置时可以使用此方法
//             },
//             getOpId(payload, state) {
//                 当opId不能写死时，需要动态设置时可以使用此方法
//             }
//         },
//     },
    // 获取服务器监控数据
    getFullShotData: {
        // url: `${prefix}/monitor/masterWorker/list`,
        url: '/api/getFullShotData',
        method: 'GET',
        actionType: GET_FULL_SHOT_DATA_DATA_MAP
    },
//     同步操作reducres格式如下
//     actionName: createAction(./actionTypes这里的常量之一, 如不需要操作reducers里的值),
})

export default actionCreator
```

`actionTypes.js`定义活动属性

```
/**
 * 功能：动作名称
 * 作者：于利龙
 * 日期： 2020-02-04
 */

// 获取数据
export const GET_FULL_SHOT_DATA_DATA_MAP = 'GET_FULL_SHOT_DATA_DATA_MAP'
// 获取数据
export const GET_DATA_MAP_LIST_DATA_DATA_MAP = 'GET_DATA_MAP_LIST_DATA_DATA_MAP'
```



### 3.2 container文件夹写法

这个文件夹放一个个文件，每个文件大致内容如下：

```js
/**
 * 功能: 数据地图-数据全景 container
 * 作者: 于利龙
 * 日期: 2020-02-04
 */

import { connect, hot, createSelector } from 'framework/Util'
import actionCreator from '../actions/actionCreator'
import FullShot from '../components/full-shot'

const mainState = state => state.dataMap

const selector = createSelector([mainState], (reducers) => {
    // 这里获取数据
    const { fullShot } = reducers
    const {
        fullShotData
    } = fullShot.toJS()
    console.log('fullShotData: ', fullShotData)
    return {
        fullShotData
    }
})
export default connect(selector, actionCreator)(hot(module)(FullShot))
```



### 3.3 reducers文件夹写法

这个文件夹有一个主`index.js`文件：

```js
import { combineReducers } from 'framework/Util'
import fullShot from './fullShot'

export default combineReducers({ 
    // 这里填入需要聚合的子reducers
    fullShot
})
```

然后写每个reducers文件：

```js
// fullShot.js
/**
 * 功能: 页面reducers
 * 作者: xiaolong
 * 日期: 2020-02-04
 */

import { Immutable } from 'framework/Util'
import { handleActions } from 'framework'
import { 
    // actionTypes这里相关的值
    GET_FULL_SHOT_DATA_DATA_MAP
} from '../actions/actionTypes'

const initialState = Immutable.fromJS({
    // 这里写reducers的初始值，键值对形式
    // 例如: key: value
    fullShotData: []
})

const reducer = handleActions(
    {
        // 这里写修改操作
        // 异步请求修改如下
        // [actionTypes这里相关的值]: {
        //     success: (state, action) => state.set('initialState里相关的键***', 复杂类型为: Immutable.fromJS(action.payload) / 简单类型为: action.payload)
        // },
        [GET_FULL_SHOT_DATA_DATA_MAP]: {
            success: (state, action) => state.set('fullShotData', Immutable.fromJS(action.payload))
        }
        // 同步请求修改如下
        // [actionTypes这里相关的值](state, action) {
        //     return state.set('initialState里相关的键***', 复杂类型为: Immutable.fromJS(action.payload) / 简单类型为: action.payload)
        // }
    },
    initialState
)

export default reducer
```

主reducers文件写好后，还需要注册reducers文件，找到项目的`src/conf/reducers.js`文件

```js
// reducers
import dataMap from '../data-map/reducers'

export default {
    dataMap
}
```



## 4. 图片使用方法

一个组件文件夹内容：

```
.
├── images
│   └── empty.png
├── index.jsx
└── scss
    └── index.scss
```

在组件文件夹下创建`images`文件夹，图片放到这个文件夹下，使用的时候，直接用：

```css
background: url('../images/empty.png') no-repeat center center;
```

